



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.0">
    
    
      
        <title>Part 1 - Beam Documentation</title>
      
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/application.aa3de92b.css">
      
    
<link rel="stylesheet" type="text/css" href="../../css/beam.css"/>

    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../docs/theme/css/beam.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#beam-module-structure" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Beam Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Beam Documentation
              </span>
              <span class="md-header-nav__topic">
                Part 1
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/tathougies/beam/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/tathougies/beam/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Part 1
      </label>
    
    <a href="./" title="Part 1" class="md-nav__link md-nav__link--active">
      Part 1
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#beam-module-structure" title="Beam Module Structure" class="md-nav__link">
    Beam Module Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-first-table" title="Defining our first table" class="md-nav__link">
    Defining our first table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teaching-beam-about-our-table" title="Teaching Beam about our table" class="md-nav__link">
    Teaching Beam about our table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-database" title="Defining our database" class="md-nav__link">
    Defining our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-users-to-our-database" title="Adding users to our database" class="md-nav__link">
    Adding users to our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#querying-the-database" title="Querying the database" class="md-nav__link">
    Querying the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregations" title="Aggregations" class="md-nav__link">
    Aggregations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" title="Conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial2/" title="Part 2" class="md-nav__link">
      Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/insert/" title="INSERT" class="md-nav__link">
      INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Schema management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/supported/" title="Supported migrations" class="md-nav__link">
      Supported migrations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#beam-module-structure" title="Beam Module Structure" class="md-nav__link">
    Beam Module Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-first-table" title="Defining our first table" class="md-nav__link">
    Defining our first table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teaching-beam-about-our-table" title="Teaching Beam about our table" class="md-nav__link">
    Teaching Beam about our table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-database" title="Defining our database" class="md-nav__link">
    Defining our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-users-to-our-database" title="Adding users to our database" class="md-nav__link">
    Adding users to our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#querying-the-database" title="Querying the database" class="md-nav__link">
    Querying the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregations" title="Aggregations" class="md-nav__link">
    Aggregations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" title="Conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tathougies/beam/edit/master/docs/tutorials/tutorial1.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Part 1</h1>
                
                <p>In this tutorial sequence, we'll walk through creating a schema for a simple
shopping cart database. We'll start by defining a user table. Then, we'll show
how beam makes it easy to manipulate data in our database. Finally, we'll
demonstrate how beam lets us declare type-safe and composable queries.</p>
<h2 id="beam-module-structure">Beam Module Structure</h2>
<p>Beam makes extensive use of GHC's Generics mechanism. This extension means beam does not need to
rely on template haskell.</p>
<p>To start defining beam schemas and queries, you only need to import the
<code>Database.Beam</code> module. To interface with an actual database, you'll need to
import one of the database backends. We'll see how to use the Sqlite backend
here (found in the <code>beam-sqlite</code> package). Now, open up a GHCi prompt for us to
use. Make sure to get the <code>beam-core</code> and <code>beam-sqlite</code> packages.</p>
<div class="codehilite"><pre><span></span><span class="gp">$</span> stack repl --package beam-core --package beam-sqlite --package sqlite-simple --package beam-migrate
</pre></div>


<p>This will put you into a GHCi prompt with the <code>beam-core</code> and <code>beam-sqlite</code>
packages available. We also include the <code>sqlite-simple</code> package. Beam mainly
manages querying and data marshalling. Connections to the backends are done via
backend specific packages. In this case, <code>beam-sqlite</code> uses the <code>sqlite-simple</code>
backend.</p>
<p>Before starting, we'll need to enable some extensions.</p>
<div class="codehilite"><pre><span></span>&gt; :set -XDeriveGeneric -XGADTs -XOverloadedStrings -XFlexibleContexts -XFlexibleInstances -XTypeFamilies -XTypeApplications
</pre></div>


<p>And import some modules...</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Database.Beam</span>
<span class="kr">import</span> <span class="nn">Database.Beam.Sqlite</span>

<span class="kr">import</span> <span class="nn">Data.Text</span> <span class="p">(</span><span class="kt">Text</span><span class="p">)</span>
</pre></div>


<h2 id="defining-our-first-table">Defining our first table</h2>
<p>Beam tables are regular Haskell data types with a bit of scaffolding. Thankfully, the magic of the
modern Haskell type system allows us to remove the overhead and the syntactic fuzz of the
scaffolding in most situations.</p>
<p>We start by declaring a data structure named <code>UserT</code>. As a matter of convention, Beam table types
are suffixed with 'T'. Table types have only one constructor. Again, as a matter of convention, the
constructor has the same name as the table, but without the 'T' suffix. We'll soon see the reason
for this convention.</p>
<p>In this tutorial, I'll prefix all record selectors with an underscore. This is a matter of personal
preference. One reason for the prefix is that it plays nicely with the <code>lens</code> library. Beam does not
necessitate the use of <code>lens</code> (in fact Beam includes its own mechanism to generically derive van
Laarhoven lenses), but I recognize that some programmers use <code>lens</code> quite a lot.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">UserT</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">User</span>
    <span class="p">{</span> <span class="n">_userEmail</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userPassword</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span> <span class="p">}</span>
    <span class="kr">deriving</span> <span class="kt">Generic</span>
</pre></div>


<p>This data type might look very complicated, so I'd like to show you that it's not that scary. Let's
see if we can use GHCi to help us.</p>
<div class="codehilite"><pre><span></span>Prelude Database.Beam.Sqlite Database.Beam Data.Text&gt; :t User
User
  :: Columnar f Text
     -&gt; Columnar f Text -&gt; Columnar f Text -&gt; Columnar f Text -&gt; UserT f
</pre></div>


<p>Hmm... That did not help much. However, consider the type of the following:</p>
<div class="codehilite"><pre><span></span>Prelude Database.Beam.Sqlite Database.Beam Data.Text&gt; :t (\email firstName lastName password -&gt; User email firstName lastName password :: UserT Identity)
(\email firstName lastName password -&gt; User email firstName lastName password :: UserT Identity)
  :: Text -&gt; Text -&gt; Text -&gt; Text -&gt; UserT Identity
</pre></div>


<p>Woah! That looks a lot like what we'd expect if we had declared the type in the "regular" Haskell way:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">User</span> <span class="ow">=</span> <span class="kt">User</span>
          <span class="p">{</span> <span class="n">_userEmail</span>     <span class="ow">::</span> <span class="kt">Text</span>
          <span class="p">,</span> <span class="n">_userFirstName</span> <span class="ow">::</span> <span class="kt">Text</span>
          <span class="p">,</span> <span class="n">_userLastName</span>  <span class="ow">::</span> <span class="kt">Text</span>
          <span class="p">,</span> <span class="n">_userPassword</span>  <span class="ow">::</span> <span class="kt">Text</span> <span class="p">}</span>
</pre></div>


<p>This functionality is due to the fact that <code>Columnar</code> is a type family defined
such that for any <code>x</code>, <code>Columnar Identity x = x</code>. This strategy is known as
<em>defunctionalization</em> <sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>.</p>
<p>Knowing this, let's define a type synonym to make our life easier.</p>
<div class="codehilite"><pre><span></span><span class="kr">type</span> <span class="kt">User</span> <span class="ow">=</span> <span class="kt">UserT</span> <span class="kt">Identity</span>
<span class="kr">type</span> <span class="kt">UserId</span> <span class="ow">=</span> <span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="kt">Identity</span>
</pre></div>


<p>Now you can see why we named the type of the table <code>UserT</code> and its constructor
<code>User</code>. This allows us to use the "regular" <code>User</code> constructor to construct
values of type <code>User</code>. We can use the <code>StandaloneDeriving</code> and
<code>TypeSynonymInstances</code> extensions to derive instances of <code>Show</code> and <code>Eq</code> for the
'regular' datatype.</p>
<div class="codehilite"><pre><span></span>&gt; :set -XStandaloneDeriving -XTypeSynonymInstances
</pre></div>


<p>Now we can derive <code>Show</code> and <code>Eq</code> instances.</p>
<div class="codehilite"><pre><span></span><span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">User</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">User</span>
</pre></div>


<p>Note that this does require us to use an explicit type signature where we
otherwise wouldn't. For example,</p>
<div class="codehilite"><pre><span></span><span class="kt">Prelude</span> <span class="kt">Database</span><span class="o">.</span><span class="kt">Beam</span><span class="o">.</span><span class="kt">Sqlite</span> <span class="kt">Database</span><span class="o">.</span><span class="kt">Beam</span> <span class="kt">Data</span><span class="o">.</span><span class="kt">Text</span><span class="o">&gt;</span> <span class="kt">User</span> <span class="s">&quot;john@example.com&quot;</span> <span class="s">&quot;John&quot;</span> <span class="s">&quot;Smith&quot;</span> <span class="s">&quot;password!&quot;</span>

<span class="o">&lt;</span><span class="n">interactive</span><span class="o">&gt;:</span><span class="mi">46</span><span class="kt">:</span><span class="mi">2</span><span class="kt">:</span> <span class="ne">error</span><span class="kt">:</span>
    <span class="o">*</span> <span class="kt">No</span> <span class="kr">instance</span> <span class="n">for</span> <span class="p">(</span><span class="kt">Show</span> <span class="p">(</span><span class="kt">UserT</span> <span class="n">f0</span><span class="p">))</span> <span class="n">arising</span> <span class="n">from</span> <span class="n">a</span> <span class="n">use</span> <span class="kr">of</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">print</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span>
    <span class="o">*</span> <span class="kt">In</span> <span class="n">a</span> <span class="n">stmt</span> <span class="kr">of</span> <span class="n">an</span> <span class="n">interactive</span> <span class="kt">GHCi</span> <span class="n">command</span><span class="kt">:</span> <span class="n">print</span> <span class="n">it</span>
</pre></div>


<p>Here, GHC is complaining that it cannot infer the type of the <code>f</code> parameter
based on the values we've supplied. This is because the <code>Columnar</code> type family
is non-injective. However, an explicit type annotation fixes it all up.</p>
<div class="codehilite"><pre><span></span>Prelude Database.Beam.Sqlite Database.Beam Data.Text&gt; User &quot;john@example.com&quot; &quot;John&quot; &quot;Smith&quot; &quot;password!&quot; :: User
User {_userEmail = &quot;john@example.com&quot;, _userFirstName = &quot;John&quot;, _userLastName = &quot;Smith&quot;, _userPassword = &quot;password!&quot;}
</pre></div>


<p>Usually, you won't need to deal with this, as you'll explicitly annotate your
top-level functions to use the <code>User</code> type.</p>
<h2 id="teaching-beam-about-our-table">Teaching Beam about our table</h2>
<p>We've defined a type that can represent the data in our table. Now, let's
inform beam that we'd like to use <code>UserT</code> as a table.</p>
<p>All beam tables need to implement the <code>Beamable</code> type class. Due to GHC's
DeriveGeneric and DefaultSignatures extensions, all these methods can be written
for us by the compiler at compile-time!</p>
<div class="codehilite"><pre><span></span><span class="kr">instance</span> <span class="kt">Beamable</span> <span class="kt">UserT</span>
</pre></div>


<p>Additionally, all beam tables must implement the <code>Table</code> type class, which we
can use to declare a primary key.</p>
<p>The only thing we need to provide is the type of the primary keys for users, and
a function that can extract the primary key from any <code>UserT f</code> object. To do
this, add the following lines to the instance declaration.</p>
<div class="codehilite"><pre><span></span><span class="kr">instance</span> <span class="kt">Table</span> <span class="kt">UserT</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="p">(</span><span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span><span class="p">)</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
    <span class="n">primaryKey</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="o">.</span> <span class="n">_userEmail</span>
<span class="kr">instance</span> <span class="kt">Beamable</span> <span class="p">(</span><span class="kt">PrimaryKey</span> <span class="kt">UserT</span><span class="p">)</span>
</pre></div>


<p>The <code>data</code> declaration is similar to a toplevel data definition, construct a key
for <code>UserT</code> with the <code>UserId</code> constructor like a regular table.</p>
<div class="codehilite"><pre><span></span><span class="nf">userKey</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="s">&quot;john@doe.org&quot;</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The standalone <code>Beamable</code> instances are quite ugly. Luckily, the new
deriving strategies extension in GHC 8.2 will allow us to write the
<code>Beamable</code> instance 'in-line', so we can write <code>deriving (Generic,
Beamable)</code> instead.</p>
</div>
<h2 id="defining-our-database">Defining our database</h2>
<p>Now that we have our table, we're going to define a type to hold information about our
database. Defining our database is going to follow the same pattern as defining a table. We'll
define a higher-kinded datatype and then declare an instance of <code>Database</code>, and let the compiler
figure most of it out.</p>
<p>Tables are a collection of <code>Columnar</code> values. Databases are a collection of
entities, such as tables. Many database systems can also hold other entities
(such as views, domain types, etc). Beam allows you to declare these as well <sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup>.</p>
<p>Our database consists of only one table.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">ShoppingCartDb</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">ShoppingCartDb</span>
                      <span class="p">{</span> <span class="n">_shoppingCartUsers</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">UserT</span><span class="p">)</span> <span class="p">}</span>
                        <span class="kr">deriving</span> <span class="kt">Generic</span>

<span class="kr">instance</span> <span class="kt">Database</span> <span class="n">be</span> <span class="kt">ShoppingCartDb</span>
</pre></div>


<p>The next step is to create a description of the particular database we'd like to create. This
involves giving each of the tables in our database a name. If you've named all your database
selectors using camel case, beam can automatically figure out what all the table names should be. If
you haven't, or you have multiple tables holding the same type in your database, you might have to
manually name your tables. For now, we'll let beam do the hard work <sup id="fnref:3"><a class="footnote-ref" href="#fn:3" rel="footnote">3</a></sup>.</p>
<div class="codehilite"><pre><span></span><span class="nf">shoppingCartDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ShoppingCartDb</span>
<span class="nf">shoppingCartDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span>
</pre></div>


<h2 id="adding-users-to-our-database">Adding users to our database</h2>
<p>Let's add some users to our database. As we said above, beam is
backend-agnostic. However, backend integration libraries are maintained in the
official beam repository. The <code>beam-sqlite</code> package offers straightforwards
integration with the <code>sqlite-simple</code> library.</p>
<p>First, let's create a sqlite3 database with the right schema. Open up terminal, and do</p>
<div class="codehilite"><pre><span></span><span class="gp">$</span> sqlite3 shoppingcart1.db
<span class="go">SQLite version 3.14.0 2016-07-26 15:17:14</span>
<span class="go">Enter &quot;.help&quot; for usage hints.</span>
<span class="go">sqlite&gt; CREATE TABLE cart_users (email VARCHAR NOT NULL, first_name VARCHAR NOT NULL, last_name VARCHAR NOT NULL, password VARCHAR NOT NULL, PRIMARY KEY( email ));</span>
<span class="go">sqlite&gt;</span>
</pre></div>


<p>Now, let's open the database in Haskell.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nn">Database.SQLite.Simple</span>

<span class="nf">conn</span> <span class="ow">&lt;-</span> <span class="n">open</span> <span class="s">&quot;shoppingcart1.db&quot;</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previous versions of beam would attempt automatic schema migration. This is
dangerous and not required for many use cases. A more powerful
implementation of this functionality has been moved into the optional
<code>beam-migrate</code> package.
See <a href="../../schema-guide/migrations/">the appropriate documentation</a></p>
</div>
<p>Now let's add a few users. We'll give each user an MD5 encoded password too.
We'll use the <code>runBeamSqliteDebug</code> function (supplied by <code>beam-sqlite</code>) to
output the statements that beam would normally run. In production, you'd use the
<code>runBeamSqlite</code> function, or use the backend integration packages to directly
use the underlying backend library.</p>
<div class="codehilite"><pre><span></span><span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="cm">{- for debug output -}</span> <span class="n">conn</span> <span class="o">$</span> <span class="n">runInsert</span> <span class="o">$</span>
<span class="nf">insert</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span> <span class="o">$</span>
<span class="nf">insertValues</span> <span class="p">[</span> <span class="kt">User</span> <span class="s">&quot;james@example.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;Smith&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span> <span class="cm">{- james -}</span>
             <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;betty@example.com&quot;</span> <span class="s">&quot;Betty&quot;</span> <span class="s">&quot;Jones&quot;</span> <span class="s">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span> <span class="cm">{- betty -}</span>
             <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;sam@example.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Taylor&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span> <span class="cm">{- sam -}</span> <span class="p">]</span>
</pre></div>


<p>The <code>runInsert</code> function runs an insert statement, which we construct using the
<code>insert</code> function. Since we're inserting concrete values, we use the
<code>insertValues</code> function to supply the values. We can also use the
<code>insertExpressions</code> function to insert arbitrary SQL expressions, or the
<code>insertFrom</code> to insert the results of an arbitrary select (the <code>INSERT INTO ..
SELECT ..</code> syntax).</p>
<p>Because we're in debug mode, we'll see the SQL that beam is running:</p>
<div class="codehilite"><pre><span></span>INSERT INTO &quot;cart_users&quot;(&quot;email&quot;, &quot;first_name&quot;, &quot;last_name&quot;, &quot;password&quot;) VALUES (?, ?, ?, ?), (?, ?, ?, ?), (?, ?, ?, ?)
-- With values: [SQLText &quot;james@example.com&quot;,SQLText &quot;James&quot;,SQLText &quot;Smith&quot;,SQLText &quot;b4cc344d25a2efe540adbf2678e2304c&quot;,SQLText &quot;betty@example.com&quot;,SQLText &quot;Betty&quot;,SQLText &quot;Jones&quot;,SQLText &quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;,SQLText &quot;sam@example.com&quot;,SQLText &quot;Sam&quot;,SQLText &quot;Taylor&quot;,SQLText &quot;332532dcfaa1cbf61e2a266bd723612c&quot;]
</pre></div>


<p>The <code>?</code> represent the values passed to the database (beam uses the backend's
value interpolation to avoid SQL injection attacks).</p>
<h2 id="querying-the-database">Querying the database</h2>
<p>Now let's write some queries for the database. Let's get all the users we just
added. Click between the tabs to see the SQL and console output generated</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-Haskell" aria-controls="tab-0-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Sql" aria-controls="tab-0-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Output" aria-controls="tab-0-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-Haskell">
            <div class="codehilite"><pre><span></span><span class="kr">let</span> <span class="n">allUsers</span> <span class="ow">=</span> <span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">users</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="n">allUsers</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">users</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Sql">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Output">
            <div class="codehilite"><pre><span></span>User {_userEmail = &quot;james@example.com&quot;, _userFirstName = &quot;James&quot;, _userLastName = &quot;Smith&quot;, _userPassword = &quot;b4cc344d25a2efe540adbf2678e2304c&quot;}
User {_userEmail = &quot;betty@example.com&quot;, _userFirstName = &quot;Betty&quot;, _userLastName = &quot;Jones&quot;, _userPassword = &quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;}
User {_userEmail = &quot;sam@example.com&quot;, _userFirstName = &quot;Sam&quot;, _userLastName = &quot;Taylor&quot;, _userPassword = &quot;332532dcfaa1cbf61e2a266bd723612c&quot;}
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>--</code> at the ends of the console output lines are an artifact of the
documentation build process. They won't appear in your console.</p>
</div>
<p>Next let's suppose you wanted to sort the users into order by their first name,
and then descending by their last name. We can use the <code>orderBy_</code> function to
order the query results. This is similar to the <code>sortBy</code> function for lists.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-Haskell" aria-controls="tab-1-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Sql" aria-controls="tab-1-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Output" aria-controls="tab-1-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-Haskell">
            <div class="codehilite"><pre><span></span><span class="kr">let</span> <span class="n">sortUsersByFirstName</span> <span class="ow">=</span> <span class="n">orderBy_</span> <span class="p">(</span><span class="nf">\</span><span class="n">u</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">asc_</span> <span class="p">(</span><span class="n">_userFirstName</span> <span class="n">u</span><span class="p">),</span> <span class="n">desc_</span> <span class="p">(</span><span class="n">_userLastName</span> <span class="n">u</span><span class="p">)))</span> <span class="p">(</span><span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">))</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">users</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="n">sortUsersByFirstName</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">users</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Sql">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">ASC</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">DESC</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Output">
            <div class="codehilite"><pre><span></span>User {_userEmail = &quot;betty@example.com&quot;, _userFirstName = &quot;Betty&quot;, _userLastName = &quot;Jones&quot;, _userPassword = &quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;}
User {_userEmail = &quot;james@example.com&quot;, _userFirstName = &quot;James&quot;, _userLastName = &quot;Smith&quot;, _userPassword = &quot;b4cc344d25a2efe540adbf2678e2304c&quot;}
User {_userEmail = &quot;sam@example.com&quot;, _userFirstName = &quot;Sam&quot;, _userLastName = &quot;Taylor&quot;, _userPassword = &quot;332532dcfaa1cbf61e2a266bd723612c&quot;}
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>We can use <code>limit_</code> and <code>offset_</code> in a similar manner to <code>take</code> and <code>drop</code> respectively.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-2-Haskell" aria-controls="tab-2-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Sql" aria-controls="tab-2-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Output" aria-controls="tab-2-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-Haskell">
            <div class="codehilite"><pre><span></span><span class="kr">let</span> <span class="n">boundedQuery</span> <span class="ow">::</span> <span class="kt">Q</span> <span class="kt">SqliteSelectSyntax</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kr">_</span>
    <span class="n">boundedQuery</span> <span class="ow">=</span> <span class="n">limit_</span> <span class="mi">1</span> <span class="o">$</span> <span class="n">offset_</span> <span class="mi">1</span> <span class="o">$</span>
                   <span class="n">orderBy_</span> <span class="p">(</span><span class="n">asc_</span> <span class="o">.</span> <span class="n">_userFirstName</span><span class="p">)</span> <span class="o">$</span>
                   <span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">users</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="p">(</span><span class="n">select</span> <span class="n">boundedQuery</span> <span class="ow">::</span> <span class="kt">SqlSelect</span> <span class="kt">SqliteSelectSyntax</span> <span class="kr">_</span><span class="p">)</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">users</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Sql">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">ASC</span>
<span class="k">LIMIT</span> <span class="mi">1</span>
<span class="k">OFFSET</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Output">
            <div class="codehilite"><pre><span></span>User {_userEmail = &quot;james@example.com&quot;, _userFirstName = &quot;James&quot;, _userLastName = &quot;Smith&quot;, _userPassword = &quot;b4cc344d25a2efe540adbf2678e2304c&quot;}
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The type signatures above are not necessary when run in GHCi. The
documentation automates building and testing the queries, but the above
results in strange type errors in GHC. This may be a compiler type-inference
bug. More investigation is being carried out.</p>
<p>Nevertheless, this shows how you could limit your queries to only work in a
particular syntax.</p>
<p>The <code>_</code> are type holes, which means GHC will happily infer these types, if
the <code>PartialTypeSignatures</code> extension is turned on.</p>
</div>
<h2 id="aggregations">Aggregations</h2>
<p>Sometimes we also want to group our data together and perform calculations over
the groups of data. SQL calls these aggregations.</p>
<p>The simplest aggregation is counting. We use the <code>aggregate_</code> function to create
aggregations. For example, to count all users, we can use the <code>countAll_</code>
aggregation. We also use the <code>runSelectReturningOne</code> function to get at most one
record from the database.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-3-Haskell" aria-controls="tab-3-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Sql" aria-controls="tab-3-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Output" aria-controls="tab-3-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-Haskell">
            <div class="codehilite"><pre><span></span><span class="kr">let</span> <span class="n">userCount</span> <span class="ow">=</span> <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="n">u</span> <span class="ow">-&gt;</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="n">countAll_</span><span class="p">)</span> <span class="p">(</span><span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">))</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="kt">Just</span> <span class="n">c</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningOne</span> <span class="o">$</span> <span class="n">select</span> <span class="n">userCount</span>
  <span class="n">liftIO</span> <span class="o">$</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;We have &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">c</span> <span class="o">++</span> <span class="s">&quot; users in the database&quot;</span><span class="p">)</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Sql">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Output">
            <div class="codehilite"><pre><span></span>We have 3 users in the database
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>countAll_</code> is happy to unmarshal into any <code>Integral</code> type, so we use <code>as_</code>
to constrain the type to <code>Int</code>.</p>
</div>
<p>Maybe we'd like something a little more interesting, such as the number of users
for each unique first name. We can also express these aggregations using the
<code>aggregate_</code> function. In order to get interesting results, we'll need to add
more users to our database. We'll demonstrate using <code>withDatabase</code> to silence the debug messages.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-4-Haskell" aria-controls="tab-4-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Sql" aria-controls="tab-4-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-Haskell">
            <div class="codehilite"><pre><span></span><span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
  <span class="n">runInsert</span> <span class="o">$</span>
  <span class="n">insert</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertValues</span> <span class="p">[</span> <span class="kt">User</span> <span class="s">&quot;james@pallo.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;Pallo&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span> <span class="cm">{- james -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;betty@sims.com&quot;</span> <span class="s">&quot;Betty&quot;</span> <span class="s">&quot;Sims&quot;</span> <span class="s">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span> <span class="cm">{- betty -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;james@oreily.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;O&#39;Reily&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span> <span class="cm">{- james -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;sam@sophitz.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Sophitz&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span> <span class="cm">{- sam -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;sam@jely.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Jely&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span> <span class="cm">{- sam -}</span> <span class="p">]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Sql">
            <div class="codehilite"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;cart_users&quot;</span><span class="p">(</span><span class="ss">&quot;email&quot;</span><span class="p">,</span>
                         <span class="ss">&quot;first_name&quot;</span><span class="p">,</span>
                         <span class="ss">&quot;last_name&quot;</span><span class="p">,</span>
                         <span class="ss">&quot;password&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span>
        <span class="o">?</span><span class="p">,</span>
        <span class="o">?</span><span class="p">,</span>
        <span class="o">?</span><span class="p">),</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span>
             <span class="o">?</span><span class="p">,</span>
             <span class="o">?</span><span class="p">,</span>
             <span class="o">?</span><span class="p">),</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span>
                  <span class="o">?</span><span class="p">,</span>
                  <span class="o">?</span><span class="p">,</span>
                  <span class="o">?</span><span class="p">),</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span>
                       <span class="o">?</span><span class="p">,</span>
                       <span class="o">?</span><span class="p">,</span>
                       <span class="o">?</span><span class="p">),</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span>
                            <span class="o">?</span><span class="p">,</span>
                            <span class="o">?</span><span class="p">,</span>
                            <span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLText &quot;james@pallo.com&quot;,SQLText &quot;James&quot;,SQLText &quot;Pallo&quot;,SQLText &quot;b4cc344d25a2efe540adbf2678e2304c&quot;,SQLText &quot;betty@sims.com&quot;,SQLText &quot;Betty&quot;,SQLText &quot;Sims&quot;,SQLText &quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;,SQLText &quot;james@oreily.com&quot;,SQLText &quot;James&quot;,SQLText &quot;O&#39;Reily&quot;,SQLText &quot;b4cc344d25a2efe540adbf2678e2304c&quot;,SQLText &quot;sam@sophitz.com&quot;,SQLText &quot;Sam&quot;,SQLText &quot;Sophitz&quot;,SQLText &quot;332532dcfaa1cbf61e2a266bd723612c&quot;,SQLText &quot;sam@jely.com&quot;,SQLText &quot;Sam&quot;,SQLText &quot;Jely&quot;,SQLText &quot;332532dcfaa1cbf61e2a266bd723612c&quot;]</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>Now we can use <code>aggregate_</code> to both group by a user's first name, and then count
the number of users.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-5-Haskell" aria-controls="tab-5-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Sql" aria-controls="tab-5-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Output" aria-controls="tab-5-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-Haskell">
            <div class="codehilite"><pre><span></span><span class="kr">let</span> <span class="n">numberOfUsersByName</span> <span class="ow">=</span> <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="n">u</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">group_</span> <span class="p">(</span><span class="n">_userFirstName</span> <span class="n">u</span><span class="p">),</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="n">countAll_</span><span class="p">))</span> <span class="o">$</span>
                          <span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">countedByName</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="n">numberOfUsersByName</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">countedByName</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Sql">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Output">
            <div class="codehilite"><pre><span></span>(&quot;Betty&quot;,2)
(&quot;James&quot;,3)
(&quot;Sam&quot;,3)
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial, we've covered creating a database schema, opening up a beam
database, inserting values into the database, and querying values from them. We
used the knowledge we learned to create a partial shopping cart database that
contains information about users. In the next tutorial, we'll delve deeper into
the some of the query types and show how we can create relations between tables.
We'll also use the monadic query interface to create SQL joins.</p>
<p>Until next time!</p>
<p>If you have any questions about beam, feel free to send them to
travis@athougies.net . Pull requests and bug reports are welcome
on <a href="https://github.com/tathougies/beam">GitHub</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Thanks to various bloggers for pointing this out. You can read more about this technique
   <a href="https://typesandkinds.wordpress.com/2013/04/01/defunctionalization-for-the-win/">here</a>.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Adding entities other than tables is covered in more depth in
   the <a href="../../user-guide/databases/">user guide</a>.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>More on the default naming conventions can be found in
   the <a href="../../user-guide/models/">models section</a> of the user guide. We'll talk
   about how to override defaults in the next sections.&#160;<a class="footnote-backref" href="#fnref:3" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../about/faq/" title="Frequently Asked Questions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Frequently Asked Questions
              </span>
            </div>
          </a>
        
        
          <a href="../tutorial2/" title="Part 2" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Part 2
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../assets/javascripts/application.9fb73e57.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

    
      
    
  </body>
</html>